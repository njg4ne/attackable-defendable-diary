<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diary</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <style>
      :root {
        color-scheme: light dark;
        font-family: Arial, Helvetica, sans-serif;
      }
      textarea {
        width: 100%;
        resize: vertical;
        min-height: 3rem;
      }
    </style>
  </head>
  <body>
    <h1>Diary</h1>
    <p id="welcome"></p>
    <label for="nameInput">Name</label>
    <input type="text" id="nameInput" name="name" aria-label="Name" />
    <p>
      Your custom link:
      <a id="customLink">(type your name to get a custom link)</a>
    </p>
    <!-- <p>Example link: <a href="?user=SomeName">?user=SomeName</a></p> -->
    <form id="diaryForm">
      <fieldset>
        <legend>Diary Editor</legend>
        <textarea name="diary" aria-label="diary"></textarea>
      </fieldset>
    </form>

    <script type="module">
      const params = new URLSearchParams(window.location.search);
      const user = params.get("user");
      const welcome = document.querySelector("#welcome");
      if (Boolean(user)) {
        const toInsert = user;
        welcome.innerHTML = `Welcome back, ${toInsert}!`;
      }

      function onNameInput(event) {
        customLink.href = `?user=${event.target.value}`;
        customLink.textContent = customLink.href;
      }
      nameInput.addEventListener("input", onNameInput);
    </script>
    <script type="module">
      const STORAGE_KEY = "diaryContent";
      const diaryForm = document.getElementById("diaryForm");
      function onInput(inputEvent) {
        window.localStorage.setItem(STORAGE_KEY, inputEvent.target.value);
      }
      function onPageLoad() {
        if (!diaryForm.diary) return;
        diaryForm.diary.value = window.localStorage.getItem(STORAGE_KEY) ?? "";
        diaryForm.diary.addEventListener("input", onInput);
      }
      window.addEventListener("load", onPageLoad);
    </script>
  </body>
</html>
